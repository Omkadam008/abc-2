name: Calculator CI/CD Pipeline

on:
  push:
    branches:
      - main

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-test-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout source code
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Basic CI validation 
      - name: Validate project structure
        run: |
          echo "Checking required files..."
          test -f index.html || (echo "index.html missing" && exit 1)
          test -f style.css || (echo "style.css missing" && exit 1)
          test -f script.js || (echo "script.js missing" && exit 1)
          echo "All required files are present."

      # 3️⃣ Optional lint-style check 
      - name: Basic HTML sanity check
        run: |
          grep -qi "<html" index.html
          grep -qi "<script" index.html

      # 4️⃣ Configure GitHub Pages
      - name: Configure GitHub Pages
        uses: actions/configure-pages@v5

      # 5️⃣ Upload site as Pages artifact
      - name: Upload website files
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      # 6️⃣ Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
